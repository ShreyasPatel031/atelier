# Missing Functionality in Current Minimal Version

## What's Currently Working ✅
- Tool selection (9/9 tests passing)
- Basic question generation
- Basic diagram creation
- Codebase tool calls

## What's Missing from Full Version ❌

### 1. **Rich Selection Context**
- **Missing:** Detailed selection context with node/edge details, labels, group information
- **Impact:** Agent can't see what's selected to make informed edits
- **Location in backup:** Lines 145-248 (selection context building)

### 2. **Full Graph State Description**
- **Missing:** Complete graph structure, all node/edge labels, group labels
- **Impact:** Agent doesn't know what's already on canvas
- **Location in backup:** Lines 250-262 (graph state description)

### 3. **Unanswered Question Detection**
- **Missing:** Proper detection of unanswered questions in conversation history
- **Impact:** Agent might ask multiple questions or proceed when it should wait
- **Location in backup:** Lines 454-494 (hasUnansweredQuestion helper)

### 4. **Question Sequence Tracking**
- **Missing:** Tracking of question sequences and answers
- **Impact:** Can't properly manage multi-turn question flows
- **Location in backup:** Lines 496-524 (getCurrentQuestionSequence)

### 5. **Rich Agent Context**
- **Missing:** Full agentContext with all canvas/selection/conversation details
- **Impact:** Less context for decision making
- **Location in backup:** Lines 526-580 (agentContext building)

### 6. **Image Processing**
- **Missing:** Proper image content processing for OpenAI format
- **Impact:** Images might not be properly sent to model
- **Location in backup:** Lines 272-300 (processedMessages with images)

### 7. **Error Recovery for Tool Calls**
- **Missing:** Progressive JSON parsing, error recovery for malformed tool arguments
- **Impact:** Tool calls might fail silently on parsing errors
- **Location in backup:** Lines 1330-1590 (error recovery logic)

### 8. **Multiple Tool Call Handling**
- **Missing:** Proper handling of multiple tool calls in single response
- **Impact:** Only processes first tool call, might miss others
- **Location in backup:** Lines 948-1097 (toolCallsByIndex Map)

### 9. **Comprehensive Logging**
- **Missing:** Debug logging, agent logs, fetch-based logging
- **Impact:** Harder to debug issues
- **Location in backup:** Various #region agent log sections

### 10. **Selection-Based Editing**
- **Missing:** Logic to detect when user wants to edit selected elements
- **Impact:** Can't properly handle "add X to selected node" type requests
- **Location in backup:** Selection context in prompt

## Questions Being Generated

The actual question text comes from the `ask_clarifying_question` tool call arguments. The model generates questions like:
- "What type of [system] do you want to create?"
- "What is the primary use case for [system]?"
- "What technologies should be included in [system]?"

Options are also generated by the model (4 options per question).

