/*
@tailwind base; adds base styles to all elements:
https://tailwindcss.com/docs/preflight
*/
@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  font-family: Arial, Helvetica, sans-serif;
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
}

/* Disable edge pointer events when dots are expanded to prevent edges from intercepting mouse events */
body.dots-expanded .react-flow__edge-interaction,
body.dots-expanded .react-flow__edge-path {
  pointer-events: none !important;
}

/* Force edge SVG container to be below nodes when dots are expanded */
body.dots-expanded .react-flow__edges {
  z-index: 1000 !important; /* Below nodes (4000) and dots (10000) */
}

/* Ensure nodes with expanded dots are visually above edges */
body.dots-expanded .react-flow__node.selected {
  z-index: 4000 !important; /* Above edges (2000) but below dots (10000) */
}

/* Ensure the ReactFlow node wrapper is also above edges */
body.dots-expanded .react-flow__node {
  z-index: 4000 !important;
}

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 0 0% 3.9%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 3.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 3.9%;
    --primary: 0 0% 9%;
    --primary-foreground: 0 0% 98%;
    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 9%;
    --muted: 0 0% 96.1%;
    --muted-foreground: 0 0% 45.1%;
    --accent: 0 0% 96.1%;
    --accent-foreground: 0 0% 9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 89.8%;
    --input: 0 0% 89.8%;
    --ring: 0 0% 3.9%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;
    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
  .dark {
    --background: 0 0% 3.9%;
    --foreground: 0 0% 98%;
    --card: 0 0% 3.9%;
    --card-foreground: 0 0% 98%;
    --popover: 0 0% 3.9%;
    --popover-foreground: 0 0% 98%;
    --primary: 0 0% 98%;
    --primary-foreground: 0 0% 9%;
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 98%;
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;
    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 83.1%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

/* Microphone button animations */
@keyframes pulse {
  0% {
    transform: scale(1);
  }
  70% {
    transform: scale(1.05);
  }
  100% {
    transform: scale(1);
  }
}

.mic-button:hover {
  animation: pulse 1.5s infinite;
}

/* Center input placeholder */
input::placeholder {
  text-align: center;
}

/* Smooth transitions */
.transition-all {
  transition-property: all;
}

.ease-out {
  transition-timing-function: cubic-bezier(0, 0, 0.2, 1);
}

/* 
 * Node and Group Styling - Applied via CSS to complement centralized canvasStyles.ts
 * These rules ensure ReactFlow's default styles don't override our centralized styling
 * The actual values come from canvasStyles.ts - this is just enforcement
 */

/* Hover state - remove shadows and apply hover border color */
/* Apply transition for smooth hover effects */
.react-flow__node.selectable,
/* Group nodes - no default border (they handle their own borders internally) */
.react-flow__node-group,
.react-flow__node-group.selectable,
.react-flow__node-group.selectable > div[data-testid="react-flow-node"] {
  border: none !important;
  box-shadow: none !important;
}

/* Regular nodes get transitions */
.react-flow__node.selectable > div[data-testid="react-flow-node"] {
  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.react-flow__node.selectable:hover,
.react-flow__node-default.selectable:hover,
.react-flow__node-input.selectable:hover,
.react-flow__node-output.selectable:hover,
.react-flow__node.selectable:hover > div[data-testid="react-flow-node"] {
  box-shadow: none !important;
  border-color: #D4D4DB !important;
}

/* Group nodes handle their own hover state - don't apply ReactFlow hover styles */
.react-flow__node-group.selectable:hover,
.react-flow__node-group.selectable:hover > div[data-testid="react-flow-node"],
.react-flow__node.react-flow__node-group.selectable:hover > div,
.react-flow__node-group.selectable:hover div[data-testid="react-flow-node"],
.react-flow__node.selectable:hover[class*="group"] > div,
.group-node-hovered {
  border: none !important;
  box-shadow: none !important;
}

/* Selected state - apply gray border (only in arrow mode) with transition */
.arrow-mode .react-flow__node.selectable.selected,
.arrow-mode .react-flow__node-default.selectable.selected,
.arrow-mode .react-flow__node-input.selectable.selected,
.arrow-mode .react-flow__node-output.selectable.selected,
.arrow-mode .react-flow__node.selectable.selected > div[data-testid="react-flow-node"] {
  border-color: #D4D4DB !important; /* Gray border for selected nodes */
  box-shadow: none !important;
  transition: border-color 0.2s ease-in-out, opacity 0.2s ease-in-out !important;
}

/* Group nodes have their own selection UI, so don't apply border here */
.react-flow__node-group.selectable.selected,
.react-flow__node-group.selectable.selected > div[data-testid="react-flow-node"] {
  border: none !important;
  box-shadow: none !important;
}

/* Hide ReactFlow selection rectangles when NOT in arrow mode */
.non-arrow-mode .react-flow__nodesselection,
.non-arrow-mode .react-flow__nodesselection-rect {
  display: none !important;
}

/* Hide ReactFlow selection rectangles for group nodes - they have their own selection UI */
.react-flow__node-group + .react-flow__nodesselection,
.react-flow__node-group ~ .react-flow__nodesselection,
.react-flow__node[data-id*="group"] + .react-flow__nodesselection,
.react-flow__node[data-id*="group"] ~ .react-flow__nodesselection {
  display: none !important;
}

/* ReactFlow selection box styling - only show in arrow mode, transparent with blue stroke */
.arrow-mode .react-flow__nodesselection-rect {
  background: transparent !important;
  border: 1px solid rgba(66, 133, 244, 0.5) !important;
  border-style: solid !important;
  border-radius: 0px !important; /* Rectangle, no rounded corners */
  overflow: visible !important; /* Allow corner squares to be visible */
  position: relative !important;
  transition: opacity 0.2s ease-in-out !important;
  /* DEBUG: Uncomment to see rect bounds and positioning */
  /* box-shadow: inset 0 0 0 1px rgba(255, 0, 0, 0.3) !important; */
}

/* Four corner squares for ReactFlow selection box - 8px squares, 1px border, #4285F4 at 50% opacity */
/* Using pseudo-elements on both container and rect to get all 4 corners */
/* Only show in arrow mode */
.arrow-mode .react-flow__nodesselection {
  position: relative;
}

/* Top-right corner only - positioned directly on the rect element so it moves/zooms with it */
/* The CENTER of the white rectangle should align with the corner of the selection box */
.arrow-mode .react-flow__nodesselection-rect::before {
  content: '';
  position: absolute;
  width: 8px;
  height: 8px;
  border: 1px solid rgba(66, 133, 244, 0.5) !important; /* #4285F4 at 50% opacity, 1px width */
  background: white !important; /* White fill */
  pointer-events: none;
  z-index: 1;
  /* Position so the center of the 8px square is at the top-right corner of the rect */
  /* For an 8px square, center is 4px from each edge */
  /* To center on corner: position top-right corner of square 4px away, then center is at corner */
  top: -4px; /* Move up by half height (4px) so center aligns with top edge */
  right: -4px; /* Move right by half width (4px) so center aligns with right edge */
  box-sizing: border-box;
  transition: opacity 0.2s ease-in-out;
  /* Scale inversely to zoom to keep visual size constant */
  /* Scale from center so the center stays aligned */
  transform: scale(var(--corner-scale, 1));
  transform-origin: center;
}

/* Hide all other corners */
.arrow-mode .react-flow__nodesselection-rect::after {
  display: none !important;
}

.arrow-mode .react-flow__nodesselection::before {
  display: none !important;
}

.arrow-mode .react-flow__nodesselection::after {
  display: none !important;
}


/* Group hover preview - border is set inline, don't override it */
.group-hover-preview {
  outline: none !important;
  box-shadow: none !important;
}

/* DEBUG: Force resize handle hover areas to be green - override everything */
[data-resize-handle="true"] {
  background: rgba(0, 255, 0, 0.3) !important; /* Reduced opacity */
  border: 2px solid rgba(0, 200, 0, 0.6) !important; /* Reduced opacity */
}

/* Ensure resize handle inner rectangles are white and have no border */
[data-resize-handle="true"] > div {
  border: none !important;
  background: #FFFFFF !important;
}

/* ReactFlow node wrapper - only clip the selection rectangle, not the node content */
/* Don't apply overflow hidden here as it clips the green hover areas and dots */
.react-flow__node {
  border-radius: 8px !important;
}

/* ReactFlow node selected state wrapper */
.react-flow__node.selected {
  border-radius: 8px !important;
}

/* Z-index hierarchy - centrally managed from canvasStyles.ts */
/* From bottom to top: groups (1000) → nodes (2000) → edges (3000) */

/* Groups should be the bottom layer */
.react-flow__node[data-type="group"],
.react-flow__node[data-id*="group"],
.react-flow__node-group,
.react-flow__node-draftGroup {
  z-index: 1000 !important; /* CANVAS_STYLES.zIndex.groups */
}

/* Regular nodes (not groups) should be above groups */
.react-flow__node:not([data-type="group"]):not([data-id*="group"]):not(.react-flow__node-group):not(.react-flow__node-draftGroup) {
  z-index: 3000 !important; /* CANVAS_STYLES.zIndex.nodes */
}

/* Selected nodes maintain same z-index as regular nodes */
.react-flow__node.selected:not([data-type="group"]):not([data-id*="group"]):not(.react-flow__node-group):not(.react-flow__node-draftGroup) {
  z-index: 3000 !important; /* CANVAS_STYLES.zIndex.selectedNodes */
}

/* Edges should be BELOW nodes */
/* Target all edge-related elements with maximum specificity */
.react-flow__edges,
.react-flow__edges *,
.react-flow__edge,
.react-flow__edge *,
.react-flow__edge path,
.react-flow__edge svg,
.react-flow__edge g {
  z-index: 2000 !important; /* CANVAS_STYLES.zIndex.edges - below nodes (3000) */
}

.react-flow__edge.selected,
.react-flow__edge.selected *,
.react-flow__edge.selected path,
.react-flow__edge.selected svg,
.react-flow__edge.selected g {
  z-index: 2000 !important; /* CANVAS_STYLES.zIndex.selectedEdges */
}

/* Override any inline styles ReactFlow might apply */
.react-flow__edge[style*="z-index"],
.react-flow__edge[style*="zIndex"] {
  z-index: 2000 !important;
}

/* Ports (connector dots) must be above edges - force high z-index */
/* Even though they're children of nodes (z-index 2000), we need them above edges (3000) */
[data-connector-dot="true"] {
  z-index: 6000 !important; /* CANVAS_STYLES.zIndex.nodeDots - above edges (3000) */
}
